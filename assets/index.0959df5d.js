import{o as e,c as t,a as l,w as i,v as a,b as s,t as n,d as o,F as r,r as h,e as d,f as c,g as u,h as p}from"./vendor.ef21aba8.js";import{initializeApp as g}from"https://www.gstatic.com/firebasejs/10.0.0/firebase-app.js";import{getFirestore as m,setDoc as y,doc as b,collection as T,query as A,where as C,orderBy as v,getDocs as E,deleteDoc as O}from"https://www.gstatic.com/firebasejs/10.0.0/firebase-firestore.js";import{getAuth as S,signInWithEmailAndPassword as f,signOut as w}from"https://www.gstatic.com/firebasejs/10.0.0/firebase-auth.js";!function(e=".",t="__import__"){try{self[t]=new Function("u","return import(u)")}catch(l){const i=new URL(e,location),a=e=>{URL.revokeObjectURL(e.src),e.remove()};self[t]=e=>new Promise(((l,s)=>{const n=new URL(e,i);if(self[t].moduleMap[n])return l(self[t].moduleMap[n]);const o=new Blob([`import * as m from '${n}';`,`${t}.moduleMap['${n}']=m;`],{type:"text/javascript"}),r=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(o),onerror(){s(new Error(`Failed to import: ${e}`)),a(r)},onload(){l(self[t].moduleMap[n]),a(r)}});document.head.appendChild(r)})),self[t].moduleMap={}}}("/april-bill/assets/");const N={},D={id:"forkongithub"},B=l("a",{target:"_blank",href:"https://github.com/c53hzn/april-bill"},"Fork me on GitHub",-1);N.render=function(l,i){return e(),t("span",D,[B])};const x={props:["errorMsg"],data(){return{email:"",password:"",message:this.errorMsg}},methods:{login(){this.$emit("login",{email:this.email,password:this.password})}},watch:{errorMsg(e){this.message=e}}},U={id:"login"},M=l("h1",null,"四方账单",-1),Y={class:"login-container"},k=l("div",{style:{padding:"10px 20px",background:"rgb(249, 251, 254)","border-bottom":"solid silver 1px"}}," 邮箱密码登录 ",-1),P={style:{padding:"20px"}},R={style:{color:"red"}};x.render=function(o,r,h,d,c,u){return e(),t("div",U,[M,l("div",Y,[k,l("div",P,[l("p",null,[i(l("input",{placeholder:"输入邮箱",style:{width:"200px",height:"28px","padding-left":"10px",border:"solid silver 1px","border-radius":"4px"},type:"email","onUpdate:modelValue":r[1]||(r[1]=e=>c.email=e),onKeyup:r[2]||(r[2]=s(((...e)=>u.login&&u.login(...e)),["enter"]))},null,544),[[a,c.email]])]),l("p",null,[i(l("input",{placeholder:"输入密码",style:{width:"200px",height:"28px","padding-left":"10px",border:"solid silver 1px","border-radius":"4px"},type:"password","onUpdate:modelValue":r[3]||(r[3]=e=>c.password=e),onKeyup:r[4]||(r[4]=s(((...e)=>u.login&&u.login(...e)),["enter"]))},null,544),[[a,c.password]])]),l("p",null,[l("input",{style:{width:"200px",height:"34px",color:"white",background:"rgb(0, 153, 255)",border:"none","border-radius":"4px",cursor:"pointer"},type:"submit",value:"登录",onClick:r[5]||(r[5]=(...e)=>u.login&&u.login(...e))})])])]),l("p",R,n(c.message),1)])};var K=["01","02","03","04","05","06","07","08","09",10,11,12],V=["01","02","03","04","05","06","07","08","09",10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28],_=V.concat([29]),L=_.concat([30]),I=L.concat([31]);const j={name:"DatePickerUnit",props:["startYear","endYear","year","month","day"],data(){return{monthOption:K,yearVal:this.year,monthVal:this.month,dayVal:this.day}},computed:{yearOption(){var e=(new Date).getFullYear(),t=this.startYear?this.startYear:e-10,l=this.endYear?this.endYear:e,i=[];for(let a=0;a<l-t+1;a++)i.push(t+a);return i},dayOption(){var e=this.yearVal,t=this.monthVal,l=this.dayVal,i=["01","03","05","07","08",10,12],a=["04","06","09",11];for(let s=0;s<i.length;s++)if(t==i[s])return I;for(let s=0;s<a.length;s++)if(t==a[s])return 31==l&&(this.dayVal=""),L;return e%4==0&&e%100!=0||e%400==0?(l>29&&(this.dayVal=""),_):(l>28&&(this.dayVal=""),V)}},methods:{getDateVal(){this.$emit("dateChanged",{year:this.yearVal,month:this.monthVal,day:this.dayVal})}},watch:{year(e){this.yearVal=e},month(e){this.monthVal=e},day(e){this.dayVal=e}}},F=d(" 年 "),G=d(" 月 "),W=d(" 日 ");j.render=function(a,s,d,c,u,p){return e(),t("div",null,[i(l("select",{class:"date-picker-select","onUpdate:modelValue":s[1]||(s[1]=e=>u.yearVal=e),onChange:s[2]||(s[2]=(...e)=>p.getDateVal&&p.getDateVal(...e))},[(e(!0),t(r,null,h(p.yearOption,((l,i)=>(e(),t("option",{key:i},n(l),1)))),128))],544),[[o,u.yearVal]]),F,i(l("select",{class:"date-picker-select","onUpdate:modelValue":s[3]||(s[3]=e=>u.monthVal=e),onChange:s[4]||(s[4]=(...e)=>p.getDateVal&&p.getDateVal(...e))},[(e(!0),t(r,null,h(u.monthOption,((l,i)=>(e(),t("option",{key:i},n(l),1)))),128))],544),[[o,u.monthVal]]),G,i(l("select",{class:"date-picker-select","onUpdate:modelValue":s[5]||(s[5]=e=>u.dayVal=e),onChange:s[6]||(s[6]=(...e)=>p.getDateVal&&p.getDateVal(...e))},[(e(!0),t(r,null,h(p.dayOption,((l,i)=>(e(),t("option",{key:i},n(l),1)))),128))],544),[[o,u.dayVal]]),W])};const z=m(g({apiKey:"AIzaSyBzxFOF7P9rM5UvpKyUxHqlghUNJeuZzK8",authDomain:"april-bill.firebaseapp.com",projectId:"april-bill",storageBucket:"april-bill.appspot.com",messagingSenderId:"359825891077",appId:"1:359825891077:web:f421390c6f59d71f5ea16c"})),$=S();var H=!1;localStorage.getItem("uid")&&(H=!0);var q=function(e){return{NAME:e.NAME,ACC_IN:e.ACC_IN,ACC_OUT:e.ACC_OUT,AMOUNT:e.AMOUNT,CATEGORY:e.CATEGORY,DATE:e.DATE,NATURE:e.NATURE,NOTES:e.NOTES,REMARK:e.REMARK,id:e.id}},J=function(e){return{id:e.id,NAME:e.NAME,TYPE:e.TYPE}},Z=function(e){return{id:e.id,NAME:e.NAME,TYPE:e.TYPE}},Q={NAME:"",ACC_IN:"",ACC_OUT:"",AMOUNT:"",CATEGORY:"",DATE:"",NATURE:"",NOTES:"",REMARK:"",id:""};const X={components:{ForkOnGithub:N,Login:x,DatePickerUnit:j},name:"April-Bill",data:()=>({perPageSelected:10,curPage:99,prevPage:0,nextPage:0,startYear:2020,endYear:2030,natureOption:["支出","收入","转账"],perPageOption:[10,20,50,100],pageNumOption:[],billTemplateOption:[],curPageBills:[],bills:[],accounts:[],categories:[],isShowOverlay:!1,isShowBill:!1,isShowAcc:!1,isShowCat:!1,isShowSumAcc:!1,isShowSumCat:!1,isUpdateBill:!0,billSelected:{},billTemplateName:"",billTemplates:[],accEditing:[],catEditing:[],sumAcc:[],activeSumAccType:"",sumCat:[],activeSumCatType:"",expenseTotal:0,incomeTotal:0,reserveTotal:{val:0,text:"0.00"},filter:{startDate:{year:"",month:"",day:""},endDate:{year:"",month:"",day:""},perPage:10},searchKW:"",searchResultClass:[],isLoggedin:H,isGuestMode:!1,login_errMsg:""}),computed:{prevNext(){return{prevStyle:this.prevPage?"":"disabled",nextStyle:this.nextPage?"":"disabled"}},categoryOption(){var e=this.billSelected.NATURE,t=[];for(let l=0;l<this.categories.length;l++)this.categories[l].TYPE==e&&t.push(this.categories[l].NAME);return t}},methods:{loadNewBill(e){var t=this.bills.length,l=this.perPageSelected,i=Math.ceil(t/l),a=[];for(let s=1;s<i+1;s++)a.push(s);this.pageNumOption=a,this.filter.perPage=l,this.curPage=e,this.loadBill(),this.expenseTotal=this.getExpenseTotal(this.bills),this.incomeTotal=this.getIncomeTotal(this.bills),this.reserveTotal=this.getReserveTotal(this.expenseTotal,this.incomeTotal),this.getSumAcc(),this.getSumCat(),this.clearSearch()},loadBill(){var e=this.bills.length,t=this.curPage,l=this.filter.perPage;if(0!=e){var i=Math.ceil(e/l),a=this.skipNumber(),s=this.bills.slice(a,a+l);this.curPageBills=s,this.prevPage=t-1,this.nextPage=t==i?0:t+1}else this.curPageBills=[]},loadAccCat(){},goToPrev(){0!=this.prevPage&&(this.curPage--,this.loadBill())},goToNext(){0!=this.nextPage&&(this.curPage++,this.loadBill())},showBillDetail(e){if(this.showOverlay(),this.isShowBill=!0,this.billTemplateName="",-1!=e){var t=this.curPageBills[e];this.isUpdateBill=!0,this.billSelected=q(t),this.billSelected.year=t.DATE.substring(0,4),this.billSelected.month=t.DATE.substring(5,7),this.billSelected.day=t.DATE.substring(8,10)}else{this.isUpdateBill=!1,this.billSelected=q(Q);let e=new Date,t=e.getMonth()<9?"0"+(e.getMonth()+1):e.getMonth()+1,l=e.getDate()<9?"0"+e.getDate():e.getDate();this.billSelected.year=e.getFullYear(),this.billSelected.month=t,this.billSelected.day=l,this.billSelected.DATE=[e.getFullYear(),t,l].join("-")}},showAccDetail(){this.showOverlay(),this.isShowAcc=!0,this.accEditing=[];var e=this.accounts;for(let t=0;t<e.length;t++)this.accEditing.push(J(e[t]))},showCatDetail(){this.showOverlay(),this.isShowCat=!0,this.catEditing=[];var e=this.categories;for(let t=1;t<e.length;t++)this.catEditing.push(Z(e[t]))},showSumAcc(){this.showOverlay(),this.isShowSumAcc=!0,this.sumAcc.length&&this.setActiveSumAccType(this.sumAcc[0][0].TYPE)},showSumCat(){this.showOverlay(),this.isShowSumCat=!0,this.sumCat.length&&this.setActiveSumCatType(this.sumCat[0][0].TYPE)},showOverlay(){this.isShowOverlay=!0},hideOverlay(){this.isShowOverlay=!1,this.isShowBill=!1,this.isShowAcc=!1,this.isShowCat=!1,this.isShowSumAcc=!1,this.isShowSumCat=!1},async updateBill(){var e=!!this.billSelected.NAME&&!!this.billSelected.AMOUNT,t=!1;t="转账"==this.billSelected.NATURE?!!this.billSelected.ACC_OUT&&!!this.billSelected.ACC_IN:!!this.billSelected.ACC_OUT||!!this.billSelected.ACC_IN;var l=!!this.billSelected.CATEGORY&&!!this.billSelected.DATE,i=!!this.billSelected.NATURE;if(e&&t&&l&&i){if(confirm("确认更新吗？")){var a=q(this.billSelected);a.DATE=[this.billSelected.year,this.billSelected.month,this.billSelected.day].join("-"),await y(b(z,"BOOK/BOOK001/BILL",a.id),a),this.isShowOverlay=!1,this.isShowBill=!1;const e=T(z,"BOOK/BOOK001/BILL");var s=[this.filter.startDate.year,this.filter.startDate.month,this.filter.startDate.day].join("-"),n=[this.filter.endDate.year,this.filter.endDate.month,this.filter.endDate.day].join("-");const t=A(e,C("DATE",">=",s),C("DATE","<=",n),v("DATE","desc")),l=await E(t);this.bills=[],l.forEach((e=>{let t=e.data();t.id=e.id,this.bills.push(q(t))})),this.loadNewBill(this.curPage)}}else alert("请填写所有必填项")},async addBill(){var e=!!this.billSelected.NAME&&!!this.billSelected.AMOUNT,t=!1;t="转账"==this.billSelected.NATURE?!!this.billSelected.ACC_OUT&&!!this.billSelected.ACC_IN:!!this.billSelected.ACC_OUT||!!this.billSelected.ACC_IN;var l=!!this.billSelected.CATEGORY&&!!this.billSelected.DATE,i=!!this.billSelected.NATURE;if(e&&t&&l&&i){if(confirm("确认新建吗？")){var a=new Date,s=a.getFullYear(),n=a.getMonth()+1;n=n<10?"0"+n:n;var o=a.getDate();o=o<10?"0"+o:o;var r=a.getHours();r=r<10?"0"+r:r;var h=a.getMinutes();h=h<10?"0"+h:h;var d=a.getSeconds(),c="BILL"+[s,n,o,r,h,d=d<10?"0"+d:d].join(""),u=q(this.billSelected);u.DATE=[this.billSelected.year,this.billSelected.month,this.billSelected.day].join("-"),u.id=c,await y(b(z,"BOOK/BOOK001/BILL",u.id),u),this.isShowOverlay=!1,this.isShowBill=!1;const e=T(z,"BOOK/BOOK001/BILL");var p=[this.filter.startDate.year,this.filter.startDate.month,this.filter.startDate.day].join("-"),g=[this.filter.endDate.year,this.filter.endDate.month,this.filter.endDate.day].join("-");const t=A(e,C("DATE",">=",p),C("DATE","<=",g),v("DATE","desc")),l=await E(t);this.bills=[],l.forEach((e=>{let t=e.data();t.id=e.id,this.bills.push(q(t))})),this.loadNewBill(1)}}else alert("请填写所有必填项")},async delBill(e){if(confirm("确认删除吗？")){await O(b(z,"BOOK/BOOK001/BILL",e));const i=T(z,"BOOK/BOOK001/BILL");var t=[this.filter.startDate.year,this.filter.startDate.month,this.filter.startDate.day].join("-"),l=[this.filter.endDate.year,this.filter.endDate.month,this.filter.endDate.day].join("-");const a=A(i,C("DATE",">=",t),C("DATE","<=",l),v("DATE","desc")),s=await E(a);this.bills=[],s.forEach((e=>{let t=e.data();t.id=e.id,this.bills.push(q(t))})),this.loadNewBill(this.curPage)}},addAcc(e){var t=e<9?"00"+(e+1):e<99?"0"+(e+1):e+1;this.accEditing.push({id:"ACC"+t,NAME:"",TYPE:""})},async updateAcc(){if(confirm("确认更新吗？")){var e=this.accEditing;this.accounts=[];for(let t=0;t<e.length;t++){let l=t<9?"00"+(t+1):t<99?"0"+(t+1):t+1;e[t].NAME&&e[t].TYPE?(this.accounts.push({id:"ACC"+l,NAME:e[t].NAME,TYPE:e[t].TYPE}),await y(b(z,"BOOK/BOOK001/ACCOUNT",e[t].id),{id:"ACC"+l,NAME:e[t].NAME,TYPE:e[t].TYPE})):await O(b(z,"BOOK/BOOK001/ACCOUNT",e[t].id))}this.hideOverlay(),this.getSumAcc()}},addCat(e){var t=e<10?"00"+e:e<100?"0"+e:e;this.catEditing.push({id:"CAT"+t,NAME:"",TYPE:""})},async updateCat(){if(confirm("确认更新吗？")){var e=this.catEditing;this.categories=[{id:"CAT000",NAME:"转账",TYPE:"转账"}];for(let t=0;t<e.length;t++)if(e[t].NAME&&e[t].TYPE){let l=t<9?"00"+(t+1):t<99?"0"+(t+1):t+1;this.categories.push({id:"CAT"+l,NAME:e[t].NAME,TYPE:e[t].TYPE}),await y(b(z,"BOOK/BOOK001/CATEGORY",e[t].id),{id:"CAT"+l,NAME:e[t].NAME,TYPE:e[t].TYPE})}else await O(b(z,"BOOK/BOOK001/CATEGORY",e[t].id));this.hideOverlay(),this.getSumCat()}},loadCategory(){"支出"==this.billSelected.NATURE&&(this.billSelected.ACC_IN=""),"收入"==this.billSelected.NATURE&&(this.billSelected.ACC_OUT=""),"转账"==this.billSelected.NATURE&&(this.billSelected.CATEGORY="转账")},skipNumber(){var e=this.bills.length,t=this.filter.perPage,l=this.curPage,i=Math.ceil(e/t);return 1===l?0:l===i?e-(e%t==0?t:e%t):(l-1)*t},setActiveSumAccType(e){this.activeSumAccType=e},setActiveSumCatType(e){this.activeSumCatType=e},getExpenseTotal:(e,t)=>e.reduce((function(e,l){if("支出"==l.NATURE){return((100*e+100*l.AMOUNT)/100).toFixed(2)}if(t&&l.ACC_OUT==t){return((100*e+100*l.AMOUNT)/100).toFixed(2)}return(1*e).toFixed(2)}),(0).toFixed(2)),getIncomeTotal:(e,t)=>e.reduce((function(e,l){if("收入"==l.NATURE){return((100*e+100*l.AMOUNT)/100).toFixed(2)}if(t&&l.ACC_IN==t){return((100*e+100*l.AMOUNT)/100).toFixed(2)}return(1*e).toFixed(2)}),(0).toFixed(2)),getReserveTotal(e,t){let l=(100*t-100*e)/100,i=String(l>0?l.toFixed(2):(-1*l).toFixed(2));return{val:l,text:i}},getSumAcc(){var e=this,t=this.accounts,l={};for(let r=0;r<t.length;r++)l[t[r].NAME]={TYPE:t[r].TYPE,bills:[]};var i={};for(let r=0;r<t.length;r++)i[t[r].TYPE]?i[t[r].TYPE].push(t[r].NAME):i[t[r].TYPE]=[t[r].NAME];var a=Object.keys(i),s=this.bills;for(let r=0;r<s.length;r++)"支出"==s[r].NATURE?l[s[r].ACC_OUT]&&l[s[r].ACC_OUT].bills.push(s[r]):"收入"==s[r].NATURE?l[s[r].ACC_IN]&&l[s[r].ACC_IN].bills.push(s[r]):(l[s[r].ACC_OUT].bills.push(s[r]),l[s[r].ACC_IN].bills.push(s[r]));var n=function(t,l,i){let a=e.getExpenseTotal(i,t),s=e.getIncomeTotal(i,t);return{NAME:t,TYPE:l,expenseTotal:a,incomeTotal:s,reserveTotal:e.getReserveTotal(a,s)}},o=[];for(let r=0;r<a.length;r++){let e=a[r],t=[];for(let a=0;a<i[e].length;a++){let s=i[e][a],o=n(s,e,l[s].bills);t.push(o)}o.push(t)}this.sumAcc=o,this.setActiveSumAccType(o[0][0].TYPE)},getSumCat(){var e=this.categories,t={};for(let h=0;h<e.length;h++)t[e[h].NAME]={TYPE:e[h].TYPE,bills:[]};var l={"支出":[],"收入":[],"转账":[]};for(let h=0;h<e.length;h++)l[e[h].TYPE].push(e[h].NAME);var i=["支出","收入","转账"],a=this.bills;for(let h=0;h<a.length;h++)t[a[h].CATEGORY]&&t[a[h].CATEGORY].bills.push(a[h]);var s,n,o,r=[];for(let h=0;h<i.length;h++){let e=i[h],a=[];for(let i=0;i<l[e].length;i++){let r=l[e][i],h=(s=r,n=e,o=t[r].bills,{NAME:s,TYPE:n,total:o.reduce((function(e,t){return((100*e+100*t.AMOUNT)/100).toFixed(2)}),(0).toFixed(2))});a.push(h)}r.push(a)}this.sumCat=r,this.setActiveSumCatType(r[0][0].TYPE)},getReserveClass(e){let t=e<0;return{"txt-green":!t,"txt-red":t}},getTypeClass:e=>({"txt-green":"收入"==e,"txt-red":"支出"==e}),getTxtClass:e=>({green:"收入"==e,red:"支出"==e,orange:"转账"==e}),getSumAccTypeClass(e){let t=e==this.activeSumAccType;return{show:t,hide:!t}},getSumAccBtnClass(e){return{disabled:e==this.activeSumAccType}},getSumCatTypeClass(e){let t=e==this.activeSumCatType;return{show:t,hide:!t}},getSumCatBtnClass(e){return{disabled:e==this.activeSumCatType}},changeBillDate(e){this.billSelected.year=e.year,this.billSelected.month=e.month,this.billSelected.day=e.day,this.billSelected.DATE=[e.year,e.month,e.day].join("-")},changeFilterStartDate(e){this.filter.startDate.year=e.year,this.filter.startDate.month=e.month,this.filter.startDate.day=e.day,this.filter.startDate.DATE=[e.year,e.month,e.day].join("-")},changeFilterEndDate(e){this.filter.endDate.year=e.year,this.filter.endDate.month=e.month,this.filter.endDate.day=e.day,this.filter.endDate.DATE=[e.year,e.month,e.day].join("-")},searchWithinPage(){var e=this.searchKW,t=this.curPageBills,l=[];for(let i=0;i<t.length;i++){-1!=[t[i].NAME,t[i].CATEGORY,t[i].ACC_IN,t[i].ACC_OUT].join("").indexOf(e)?l.push(""):l.push("hide")}this.searchResultClass=l},clearSearch(){this.searchKW="";var e=this.curPageBills,t=[];for(let l=0;l<e.length;l++)t.push("");this.searchResultClass=t},getLoginInfo(e){var t=e.email,l=e.password;f($,t,l).then((e=>{localStorage.setItem("uid",e.user.uid),this.isLoggedin=!0,this.login_errMsg="",this.init()})).catch((e=>{const t=e.code,l=e.message;localStorage.removeItem("uid"),this.login_errMsg="("+t+")"+l}))},logout(){w($).then((()=>{localStorage.removeItem("uid"),this.isLoggedin=!1})).catch((e=>{console.log(e)}))},getLastMonth(){var e=new Date,t=e.getFullYear(),l=e.getMonth()+1,i=e.getDate();i=i<10?"0"+i:i;var a=1==(l=l<10?"0"+l:l)?12:l-1,s=12==(a=a<10?"0"+a:a)?t-1:t,n=new Date(s,a-1,i),o=n.getDate(),r=(o<i?new Date(s,a-1,i-o):n).getDate();return{startDate:{year:s,month:a,day:r=r<10?"0"+r:r},endDate:{year:t,month:l,day:i}}},async init(){var e=this.getLastMonth();this.filter.startDate=e.startDate,this.filter.endDate=e.endDate;const t=await E(T(z,"BOOK/BOOK001/ACCOUNT")),l=await E(T(z,"BOOK/BOOK001/CATEGORY")),i=T(z,"BOOK/BOOK001/BILL");var a=[this.filter.startDate.year,this.filter.startDate.month,this.filter.startDate.day].join("-"),s=[this.filter.endDate.year,this.filter.endDate.month,this.filter.endDate.day].join("-");const n=A(i,C("DATE",">=",a),C("DATE","<=",s),v("DATE","desc")),o=await E(n),r=await E(T(z,"BOOK/BOOK001/BILL_template"));this.accounts=[],t.forEach((e=>{let t=e.data();t.id=e.id,this.accounts.push(J(t))})),this.categories=[],l.forEach((e=>{let t=e.data();t.id=e.id,this.categories.push(Z(t))})),this.bills=[],o.forEach((e=>{let t=e.data();t.id=e.id,this.bills.push(q(t))})),this.billTemplates=[],r.forEach((e=>{let t=e.data();t.id=e.id,this.billTemplateOption.push(t.NAME),this.billTemplates.push(q(t))})),this.loadNewBill(1)},loadToday(){var e=new Date,t=e.getFullYear(),l=e.getMonth()+1;l=l<10?"0"+l:l;var i=e.getDate();i=i<10?"0"+i:i,this.billSelected.year=t,this.billSelected.month=l,this.billSelected.day=i,this.billSelected.DATE=[t,l,i].join("-")},loadBillTemplate(){var e=this.billTemplateName,t=this.billTemplates;for(let l=0;l<t.length;l++)if(e==t[l].NAME){let e=this.billSelected.year,i=this.billSelected.month,a=this.billSelected.day;return this.billSelected=q(t[l]),this.billSelected.year=e,this.billSelected.month=i,this.billSelected.day=a,void(this.billSelected.DATE=[e,i,a].join("-"))}},async saveBillTemplate(){if(confirm("确定保存模板吗？")){var e=this.billSelected.NAME,t=this.billTemplates,l=t.length,i=q(this.billSelected);i.DATE="";var a="";for(let n=0;n<l;n++)if(e==t[n].NAME){a=t[n].id,i.id=a,await y(b(z,"BOOK/BOOK001/BILL_template",a),i);const e=await E(T(z,"BOOK/BOOK001/BILL_template"));return this.billTemplates=[],this.billTemplateOption=[],void e.forEach((e=>{let t=e.data();t.id=e.id,this.billTemplateOption.push(t.NAME),this.billTemplates.push(q(t))}))}a=l<9?"template00"+(l+1):l<99?"template0"+(l+1):"template"+(l+1),i.id=a,await y(b(z,"BOOK/BOOK001/BILL_template",a),i);const s=await E(T(z,"BOOK/BOOK001/BILL_template"));this.billTemplates=[],this.billTemplateOption=[],s.forEach((e=>{let t=e.data();t.id=e.id,this.billTemplateOption.push(t.NAME),this.billTemplates.push(q(t))}))}},async delBillTemplate(){var e=this.billSelected.NAME,t=this.billTemplates,l=t.length;for(let a=0;a<l;a++)if(e==t[a].NAME){var i=t[a].id;if(confirm("确定删除模板吗？")){await O(b(z,"BOOK/BOOK001/BILL_template",i));const e=await E(T(z,"BOOK/BOOK001/BILL_template"));return this.billTemplates=[],this.billTemplateOption=[],void e.forEach((e=>{let t=e.data();t.id=e.id,this.billTemplateOption.push(t.NAME),this.billTemplates.push(q(t))}))}}alert("没有这个模板")}},created(){this.isLoggedin&&this.init()}},ee={id:"app"},te={key:0,class:"main-container"},le={class:"loadbill-setting"},ie=l("h3",null,"筛选条件",-1),ae={class:"loadbill-set-unit"},se=d(" 开始时间 "),ne=d(" 结束时间 "),oe={class:"loadbill-set-unit"},re=d(" 每页条数 "),he=l("span",null," ",-1),de=l("hr",null,null,-1),ce={style:{"margin-bottom":"10px"}},ue={style:{position:"relative","text-align":"left"}},pe={class:"sum-up"},ge=d(" 支出:   "),me={class:"txt-red"},ye=l("br",null,null,-1),be={class:"sum-up"},Te=d(" 收入:   "),Ae={class:"txt-green"},Ce=l("br",null,null,-1),ve={class:"sum-up"},Ee=d(" 结余:   "),Oe={style:{position:"absolute",right:"0px",bottom:"2px","text-align":"right"}},Se=l("br",null,null,-1),fe=l("br",null,null,-1),we={style:{"margin-bottom":"10px"}},Ne={class:"pagenation-container"},De={style:{position:"relative",margin:"10px auto",width:"230px"}},Be=d(" 在此页搜索 "),xe={class:"bills"},Ue={class:"table table-striped"},Me=l("thead",null,[l("th",null,"操作"),l("th",{style:{"min-width":"100px"}},"日期"),l("th",null,"事项"),l("th",null,"分类"),l("th",{style:{"min-width":"150px"}},"账户"),l("th",null,"金额")],-1),Ye={class:"table-group-divider"},ke=l("i",{class:"fa-solid fa-eye"},null,-1),Pe=l("br",null,null,-1),Re=l("i",{class:"fa-solid fa-trash-can"},null,-1),Ke={style:{display:"inline-block"}},Ve={key:0,style:{color:"red"},class:"fa-solid fa-arrow-down"},_e={key:1},Le={key:2,style:{color:"green"},class:"fa-solid fa-arrow-up"},Ie={key:0,style:{color:"green"},class:"fa-solid fa-arrow-up"},je={key:1,style:{color:"red"},class:"fa-solid fa-arrow-down"},Fe={key:2,style:{color:"orange"},class:"fa-solid fa-repeat"},Ge=l("br",null,null,-1),We={style:{display:"block","margin-bottom":"10px"}},ze=d("日期: "),$e={style:{display:"block","margin-bottom":"10px"}},He=d("模板: "),qe=d(" 事项: "),Je=d(" 性质: "),Ze=l("br",null,null,-1),Qe=d(" 分类: "),Xe=d(" 支出账户: "),et=d(" 收入账户: "),tt=d(" 金额: "),lt=d(" 备注: "),it=d(" 详细描述: "),at={style:{"text-align":"center"}},st=l("br",null,null,-1),nt=l("br",null,null,-1),ot=d(" 账户: "),rt=l("br",null,null,-1),ht=d(" 类型: "),dt={style:{"text-align":"center"}},ct=l("br",null,null,-1),ut=d(" 分类: "),pt=l("br",null,null,-1),gt=d(" 性质: "),mt=l("option",null,"收入",-1),yt=l("option",null,"支出",-1),bt={style:{"text-align":"center"}},Tt=l("br",null,null,-1),At={key:0},Ct=l("hr",null,null,-1),vt={class:"sum-up"},Et=d(" 支出:   "),Ot={class:"txt-red"},St=l("br",null,null,-1),ft={class:"sum-up"},wt=d(" 收入:   "),Nt={class:"txt-green"},Dt=l("br",null,null,-1),Bt={class:"sum-up"},xt=d(" 结余:   "),Ut={style:{"text-align":"center"}},Mt={key:0},Yt=l("hr",null,null,-1),kt={class:"sum-up"},Pt=d(" 金额:   "),Rt={style:{"text-align":"center"}};X.render=function(s,p,g,m,y,b){const T=c("DatePickerUnit"),A=c("Login"),C=c("ForkOnGithub");return e(),t("div",ee,[y.isLoggedin?(e(),t("div",te,[l("div",le,[ie,l("div",ae,[se,l(T,{onDateChanged:b.changeFilterStartDate,startYear:y.startYear,endYear:y.endYear,year:y.filter.startDate.year,month:y.filter.startDate.month,day:y.filter.startDate.day},null,8,["onDateChanged","startYear","endYear","year","month","day"]),ne,l(T,{onDateChanged:b.changeFilterEndDate,startYear:y.startYear,endYear:y.endYear,year:y.filter.endDate.year,month:y.filter.endDate.month,day:y.filter.endDate.day},null,8,["onDateChanged","startYear","endYear","year","month","day"])]),l("div",oe,[re,i(l("select",{"onUpdate:modelValue":p[1]||(p[1]=e=>y.perPageSelected=e)},[(e(!0),t(r,null,h(y.perPageOption,((l,i)=>(e(),t("option",{key:i},n(l),1)))),128))],512),[[o,y.perPageSelected,void 0,{number:!0}]]),he,l("button",{onClick:p[2]||(p[2]=e=>b.loadNewBill(1))},"加载账单")]),l("button",{onClick:p[3]||(p[3]=(...e)=>b.logout&&b.logout(...e)),style:{position:"absolute",top:"10px",right:"10px"}},"登出")]),de,l("div",ce,[l("button",{onClick:p[4]||(p[4]=(...e)=>b.showSumAcc&&b.showSumAcc(...e))},"查看账户汇总"),l("button",{onClick:p[5]||(p[5]=(...e)=>b.showSumCat&&b.showSumCat(...e))},"查看分类汇总")]),l("div",ue,[l("span",pe,[ge,l("span",me,n(y.expenseTotal),1)]),ye,l("span",be,[Te,l("span",Ae,n(y.incomeTotal),1)]),Ce,l("span",ve,[Ee,l("span",{class:b.getReserveClass(y.reserveTotal.val)},n(y.reserveTotal.text),3)]),l("div",Oe,[l("button",{onClick:p[6]||(p[6]=(...e)=>b.showAccDetail&&b.showAccDetail(...e))},"编辑账户"),Se,l("button",{onClick:p[7]||(p[7]=(...e)=>b.showCatDetail&&b.showCatDetail(...e))},"编辑分类"),fe,l("button",{onClick:p[8]||(p[8]=e=>b.showBillDetail(-1))},"新增账单")])]),l("div",we," 共"+n(y.pageNumOption[y.pageNumOption.length-1])+"页, 共"+n(y.bills.length)+"条记录 ",1),l("div",Ne,[l("div",null,[l("span",{class:["page-item",b.prevNext.prevStyle],onClick:p[9]||(p[9]=(...e)=>b.goToPrev&&b.goToPrev(...e))}," « ",2),i(l("select",{style:{"margin-top":"-1","min-width":"50px",height:"24px","text-align":"center"},onChange:p[10]||(p[10]=(...e)=>b.loadBill&&b.loadBill(...e)),"onUpdate:modelValue":p[11]||(p[11]=e=>y.curPage=e)},[(e(!0),t(r,null,h(y.pageNumOption,((l,i)=>(e(),t("option",{key:i},n(l),1)))),128))],544),[[o,y.curPage,void 0,{number:!0}]]),l("span",{class:["page-item",b.prevNext.nextStyle],onClick:p[12]||(p[12]=(...e)=>b.goToNext&&b.goToNext(...e))}," » ",2)])]),l("div",De,[Be,i(l("input",{placeholder:"输入关键字...",style:{width:"134px",height:"34px","font-size":"16px","border-radius":"6px"},onInput:p[13]||(p[13]=(...e)=>b.searchWithinPage&&b.searchWithinPage(...e)),"onUpdate:modelValue":p[14]||(p[14]=e=>y.searchKW=e),type:"text"},null,544),[[a,y.searchKW]]),l("div",{class:["close-btn",{hide:!y.searchKW}],onClick:p[15]||(p[15]=(...e)=>b.clearSearch&&b.clearSearch(...e)),style:{top:"-7px","font-size":"30px",right:"10px"}}," × ",2)]),l("div",xe,[l("table",Ue,[Me,l("tbody",Ye,[(e(!0),t(r,null,h(y.curPageBills,((i,a)=>(e(),t("tr",{class:y.searchResultClass[a],key:i.id},[l("td",null,[l("span",{class:"act-btn",title:"查看详情",onClick:e=>b.showBillDetail(a)},[ke],8,["onClick"]),Pe,l("span",{class:"act-btn",title:"删除",onClick:e=>b.delBill(i.id)},[Re],8,["onClick"])]),l("td",null,[l("span",Ke,n(i.DATE),1)]),l("td",null,n(i.NAME),1),l("td",null,n(i.CATEGORY),1),l("td",null,[i.ACC_OUT?(e(),t("i",Ve)):u("",!0),d(" "+n(i.ACC_OUT)+" ",1),i.ACC_OUT?(e(),t("br",_e)):u("",!0),i.ACC_IN?(e(),t("i",Le)):u("",!0),d(" "+n(i.ACC_IN),1)]),l("td",null,["收入"==i.NATURE?(e(),t("i",Ie)):u("",!0),"支出"==i.NATURE?(e(),t("i",je)):u("",!0),"转账"==i.NATURE?(e(),t("i",Fe)):u("",!0),Ge,d(" "+n(i.AMOUNT),1)])],2)))),128))])])]),l("div",{class:["overlay",{show:y.isShowOverlay}],onClick:p[16]||(p[16]=(...e)=>b.hideOverlay&&b.hideOverlay(...e))},null,2),l("div",{class:["view-container",{show:y.isShowBill}]},[l("p",null,[l("span",We,[ze,l("button",{onClick:p[17]||(p[17]=(...e)=>b.loadToday&&b.loadToday(...e))},"今天")]),l(T,{style:{display:"block","margin-bottom":"10px"},onDateChanged:b.changeBillDate,startYear:y.startYear,endYear:y.endYear,year:y.billSelected.year,month:y.billSelected.month,day:y.billSelected.day},null,8,["onDateChanged","startYear","endYear","year","month","day"]),l("span",$e,[He,i(l("select",{style:{"margin-top":"-1","min-width":"50px",height:"24px"},onChange:p[18]||(p[18]=(...e)=>b.loadBillTemplate&&b.loadBillTemplate(...e)),"onUpdate:modelValue":p[19]||(p[19]=e=>y.billTemplateName=e)},[(e(!0),t(r,null,h(y.billTemplateOption,((l,i)=>(e(),t("option",{key:i},n(l),1)))),128))],544),[[o,y.billTemplateName]])])]),l("p",null,[qe,i(l("input",{"onUpdate:modelValue":p[20]||(p[20]=e=>y.billSelected.NAME=e),type:"text"},null,512),[[a,y.billSelected.NAME]])]),l("p",null,[Je,i(l("select",{"onUpdate:modelValue":p[21]||(p[21]=e=>y.billSelected.NATURE=e),onChange:p[22]||(p[22]=(...e)=>b.loadCategory&&b.loadCategory(...e))},[(e(!0),t(r,null,h(y.natureOption,((l,i)=>(e(),t("option",{key:i},n(l),1)))),128))],544),[[o,y.billSelected.NATURE]]),Ze,l("span",{class:{hide:"转账"==y.billSelected.NATURE||""==y.billSelected.NATURE}},[Qe,i(l("select",{"onUpdate:modelValue":p[23]||(p[23]=e=>y.billSelected.CATEGORY=e)},[(e(!0),t(r,null,h(b.categoryOption,((l,i)=>(e(),t("option",{key:i},n(l),1)))),128))],512),[[o,y.billSelected.CATEGORY]])],2)]),l("p",null,[l("span",{class:{hide:"收入"==y.billSelected.NATURE}},[Xe,i(l("select",{"onUpdate:modelValue":p[24]||(p[24]=e=>y.billSelected.ACC_OUT=e)},[(e(!0),t(r,null,h(y.accounts,((l,i)=>(e(),t("option",{key:i},n(l.NAME),1)))),128))],512),[[o,y.billSelected.ACC_OUT]])],2),l("br",{class:{hide:"收入"==y.billSelected.NATURE}},null,2),l("span",{class:{hide:"支出"==y.billSelected.NATURE}},[et,i(l("select",{"onUpdate:modelValue":p[25]||(p[25]=e=>y.billSelected.ACC_IN=e),title:y.billSelected.ACC_OUT},[(e(!0),t(r,null,h(y.accounts,((l,i)=>(e(),t("option",{key:i},n(l.NAME),1)))),128))],8,["title"]),[[o,y.billSelected.ACC_IN]])],2)]),l("p",null,[tt,i(l("input",{"onUpdate:modelValue":p[26]||(p[26]=e=>y.billSelected.AMOUNT=e),type:"number"},null,512),[[a,y.billSelected.AMOUNT]])]),l("p",null,[lt,i(l("input",{placeholder:"选填","onUpdate:modelValue":p[27]||(p[27]=e=>y.billSelected.REMARK=e),type:"text"},null,512),[[a,y.billSelected.REMARK]])]),l("p",null,[it,i(l("textarea",{placeholder:"选填",style:{width:"100%",height:"100px"},"onUpdate:modelValue":p[28]||(p[28]=e=>y.billSelected.NOTES=e)},null,512),[[a,y.billSelected.NOTES]])]),l("div",at,[y.isUpdateBill?(e(),t("button",{key:0,onClick:p[29]||(p[29]=(...e)=>b.updateBill&&b.updateBill(...e))},"更新")):u("",!0),l("button",{onClick:p[30]||(p[30]=(...e)=>b.addBill&&b.addBill(...e))},"另存"),l("button",{onClick:p[31]||(p[31]=(...e)=>b.hideOverlay&&b.hideOverlay(...e))},"取消"),st,nt,l("button",{onClick:p[32]||(p[32]=(...e)=>b.saveBillTemplate&&b.saveBillTemplate(...e))},"存为模板"),l("button",{onClick:p[33]||(p[33]=(...e)=>b.delBillTemplate&&b.delBillTemplate(...e))},"删除模板")]),l("div",{class:"close-btn",onClick:p[34]||(p[34]=(...e)=>b.hideOverlay&&b.hideOverlay(...e))},"×")],2),l("div",{class:["view-container",{show:y.isShowAcc}]},[(e(!0),t(r,null,h(y.accEditing,((s,n)=>(e(),t("div",{class:"view-acc",key:n},[ot,i(l("input",{"onUpdate:modelValue":e=>s.NAME=e},null,8,["onUpdate:modelValue"]),[[a,s.NAME]]),rt,ht,i(l("input",{"onUpdate:modelValue":e=>s.TYPE=e},null,8,["onUpdate:modelValue"]),[[a,s.TYPE]])])))),128)),l("div",dt,[l("button",{onClick:p[35]||(p[35]=e=>b.addAcc(y.accEditing.length))},"新增账户"),ct,l("button",{onClick:p[36]||(p[36]=(...e)=>b.updateAcc&&b.updateAcc(...e))},"更新"),l("button",{onClick:p[37]||(p[37]=(...e)=>b.hideOverlay&&b.hideOverlay(...e))},"取消")]),l("div",{class:"close-btn",onClick:p[38]||(p[38]=(...e)=>b.hideOverlay&&b.hideOverlay(...e))},"×")],2),l("div",{class:["view-container",{show:y.isShowCat}]},[(e(!0),t(r,null,h(y.catEditing,((s,n)=>(e(),t("div",{class:"view-acc",key:n},[ut,i(l("input",{"onUpdate:modelValue":e=>s.NAME=e},null,8,["onUpdate:modelValue"]),[[a,s.NAME]]),pt,gt,i(l("select",{"onUpdate:modelValue":e=>s.TYPE=e,class:b.getTypeClass(s.TYPE)},[mt,yt],10,["onUpdate:modelValue"]),[[o,s.TYPE]])])))),128)),l("div",bt,[l("button",{onClick:p[39]||(p[39]=e=>b.addCat(y.catEditing.length))},"新增分类"),Tt,l("button",{onClick:p[40]||(p[40]=(...e)=>b.updateCat&&b.updateCat(...e))},"更新"),l("button",{onClick:p[41]||(p[41]=(...e)=>b.hideOverlay&&b.hideOverlay(...e))},"取消")]),l("div",{class:"close-btn",onClick:p[42]||(p[42]=(...e)=>b.hideOverlay&&b.hideOverlay(...e))},"×")],2),l("div",{class:["view-container",{show:y.isShowSumAcc}]},[y.sumAcc.length?(e(),t("div",At,[(e(!0),t(r,null,h(y.sumAcc,((l,i)=>(e(),t("button",{key:"opt"+i,class:b.getSumAccBtnClass(l[0].TYPE),onClick:e=>b.setActiveSumAccType(l[0].TYPE)},n(l[0].TYPE),11,["onClick"])))),128))])):u("",!0),Ct,(e(!0),t(r,null,h(y.sumAcc,((i,a)=>(e(),t("div",{key:a,class:b.getSumAccTypeClass(i[0].TYPE)},[(e(!0),t(r,null,h(i,((i,s)=>(e(),t("div",{class:"view-acc",key:a+"-"+s},[l("h3",null,n(i.NAME),1),l("span",vt,[Et,l("span",Ot,n(i.expenseTotal),1)]),St,l("span",ft,[wt,l("span",Nt,n(i.incomeTotal),1)]),Dt,l("span",Bt,[xt,l("span",{class:b.getReserveClass(i.reserveTotal.val)},n(i.reserveTotal.text),3)])])))),128))],2)))),128)),l("div",Ut,[l("button",{onClick:p[43]||(p[43]=(...e)=>b.hideOverlay&&b.hideOverlay(...e))},"关闭")]),l("div",{class:"close-btn",onClick:p[44]||(p[44]=(...e)=>b.hideOverlay&&b.hideOverlay(...e))},"×")],2),l("div",{class:["view-container",{show:y.isShowSumCat}]},[y.sumCat.length?(e(),t("div",Mt,[(e(!0),t(r,null,h(y.sumCat,((l,i)=>(e(),t("button",{key:"opt"+i,class:b.getSumCatBtnClass(l[0].TYPE),onClick:e=>b.setActiveSumCatType(l[0].TYPE)},n(l[0].TYPE),11,["onClick"])))),128))])):u("",!0),Yt,(e(!0),t(r,null,h(y.sumCat,((i,a)=>(e(),t("div",{key:a},[(e(!0),t(r,null,h(i,((s,o)=>(e(),t("div",{class:["view-acc",b.getSumCatTypeClass(i[0].TYPE)],key:a+"-"+o},[l("h3",null,n(s.NAME),1),l("span",kt,[Pt,l("span",{class:b.getTxtClass(s.TYPE)},n(s.total),3)])],2)))),128))])))),128)),l("div",Rt,[l("button",{onClick:p[45]||(p[45]=(...e)=>b.hideOverlay&&b.hideOverlay(...e))},"关闭")]),l("div",{class:"close-btn",onClick:p[46]||(p[46]=(...e)=>b.hideOverlay&&b.hideOverlay(...e))},"×")],2)])):u("",!0),y.isLoggedin?u("",!0):(e(),t(A,{key:1,errorMsg:y.login_errMsg,onLogin:b.getLoginInfo},null,8,["errorMsg","onLogin"])),y.isLoggedin?u("",!0):(e(),t(C,{key:2}))])},p(X).mount("#app");
